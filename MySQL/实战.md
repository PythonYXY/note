# 9、普通索引和唯一索引，应该怎么选择？

**change buffer**：

当需要更新一个数据页时，如果数据页在内存中就直接更新，而如果这个数据页还没有在内存中的话，在不影响数据一致性的前提下，InnoDB 会将这些更新操作缓存在 change buffer 中，这样就不需要从磁盘中读入这个数据页了。在下次查询需要访问这个数据页的时候，将数据页读入内存，然后执行 change buffer 中与这个页有关的操作。通过这种方式就能保证这个数据逻辑的正确性。



**change buffer使用场景**：

- 对于写多读少的业务来说，页面在写完以后马上被访问到的概率比较小，此时 change buffer 的使用效果最好

- 假设一个业务的更新模式是写入之后马上会做查询，对于这种业务模式来说，change buffer 反而起到了副作用。

change buffer要和普通索引配合使用，不能和唯一索引配合使用



change buffer & redo log：

redo log 主要节省的是随机写磁盘的 IO 消耗（转成顺序写），而 change buffer 主要节省的则是随机读磁盘的 IO 消耗。（本来对不在内存中的数据更新时需要先把数据页读入内存再执行更新操作，但是有了change buffer，就可以先不把数据页读入内存而换成先记录在内存中的change buffer中，等到一定时机再触发merge把内存中的数据页更新，这样就减少了每次更新都要读盘的操作，也就是减少了随机读io。(而且因为change buffer同时也记录在redo log和ibdata1中，如果MySQL宕机，也可以通过崩溃恢复的机制保证记录在change buffer中的记录不丢失。更具体的恢复机制看评论区) 内存中数据页更新了之后，本来是要将更新的数据页立即刷入磁盘的(随机写)，否则MySQL宕机会丢数据；但是有了redo log，因为更新操作记录在了redo log中，不会因为系统宕机丢失数据(崩溃恢复机制)，所以内存数据更新之后就可以不用立即执行写磁盘操作，可以等待一批再随机写入磁盘，所以说redo log减少了随机写磁盘的io，把减少的随机写转换成了顺序写入redo log文件中。）



# 10、MySQL为什么有时候会选错索引？



